<?xml version = "1.0" encoding = "UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD com.example.Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.csdl.smartplacenew.mapper.ScenicspotMapper">
    <resultMap id="result" type="com.csdl.smartplacenew.pojo.Scenicspot">
        <result property="id" column="id"/>
        <result property="name" column="name" />
        <result property="lonandlat" column="lonandlat" />
        <result property="type" column="type" />
        <result property="url" column="url" />
        <result property="voiceurl" column="voiceurl" />
        <result property="status" column="status" />

        <result property="textofmater" column="textofmater" />
        <result property="size" column="size" />
        <result property="yearofesent" column="yearofesent" />
        <result property="mainteunit" column="mainteunit" />
        <result property="numofmaint" column="numofmaint" />
        <result property="maintperiod" column="maintperiod" />
        <result property="maintcost" column="maintcost" />
        <result property="maintaccounts" column="maintaccounts" />

        <result property="mandarinword" column="mandarinword" />
        <result property="englishword" column="englishword" />
        <result property="userid" column="userid" />
        <result property="sharelinks" column="sharelinks" />
    </resultMap>


    <insert id="addScenicspot">

        insert into scenicspot (name,lonandlat,type,url,voiceurl,status,
         textofmater,size,yearofesent,mainteunit,numofmaint,maintperiod,maintcost,maintaccounts,userid,sharelinks,englishword

        ) values (
        #{name},#{lonandlat},#{type},#{url},#{voiceurl},1,
           #{textofmater},#{size}, #{yearofesent}, #{mainteunit}, #{numofmaint},#{maintperiod},#{maintcost},#{maintaccounts},
           #{userid},#{sharelinks},#{englishword}

        );

   </insert>

    <select id="getScenicspotById" resultMap="result">

        select *  from scenicspot where id=#{id} and userid=#{userid}

    </select>

    <update id="updateScenicspotStatus">

        update scenicspot set status=0 where  id=#{id}  and userid=#{userid}

    </update>


    <update id="updateScenicspotById" >

        update scenicspot set
        name =#{name},
        lonandlat=#{lonandlat},
        type=#{type},
        url=#{url},
        voiceurl=#{voiceurl},

         textofmater=#{textofmater},
         size=#{size},
         yearofesent=#{yearofesent},
         mainteunit=#{mainteunit},
         numofmaint=#{numofmaint},
         maintperiod=#{maintperiod},
         maintcost=#{maintcost},
         maintaccounts=#{maintaccounts},
         sharelinks=#{sharelinks},
         englishword=#{englishword}

         where id=#{id} and userid=#{userid}

    </update>


    <select id="getScenicspotByKey"  resultMap="result">


        select *  from scenicspot

        where
        status=1
        and
        userid=#{userid}

        <if test="key!=null">
            and name like #{key} and status=1 or type like #{key} and status=1
        </if>
        order by id desc

    </select>



    <select id="getScenicspotByKeyCount"  resultType="integer">


        select count(*)  from scenicspot

        where
        status=1
        and
        userid=#{userid}

        <if test="key!=null">
            and name like #{key} and status=1 or type like #{key} and status=1
        </if>


    </select>


    <insert id="addMaintrecordsOfScen">

        insert into maintrecords (mainttype, number, maintcontent, maintcompany, contacts, contactsnum, cost, mainttime,userid)
        values (#{mainttype},#{number},#{maintcontent},#{maintcompany},#{contacts},#{contactsnum},#{cost},#{mainttime},#{userid})

    </insert>


     <select id="getScenidcIdByName"  resultType="integer">

         select  id from scenicspot where lonandlat =#{lonandlat} and status=1 and userid=#{userid}

     </select>

    <select id="getScenidcIdByName2"  resultType="integer">

         select  id from scenicspot where name =#{name} and status=1 and userid=#{userid}

     </select>


    <select id="getLonAndLat" resultType="string">

        select lonandlat from  scenicspot where status=1  and userid=#{userid}


    </select>


    <select id="getScenicpoByLonAndLat" resultMap="result">

        select *  from scenicspot where lonandlat=#{lonandlat} and  status=1  and userid=#{userid}

    </select>


    <select id="getScenicspotByUrl" resultMap="result">

        select *  from scenicspot where url=#{url} and  status=1 and userid=#{userid}

    </select>


    <insert id="addCountOfScenicspot">

        insert into count ( name, count2, monthlyvisits,type,status,yearlyvisits,userid)values (#{name},#{count2},#{monthlyvisits},#{type},#{status},#{yearlyvisits},#{userid});

    </insert>


    <select id="getScenicspotByName"  resultMap="result">

        select *  from scenicspot where name=#{name} and  status=1 and userid=#{userid}

    </select>

    <update id="updateMandarinword">

        update scenicspot
        set mandarinword=#{word}
          where id= #{id}
         and status=1
and userid=#{userid}
    </update>



    <update id="updateEnglishword">

        update scenicspot
        set englishword=#{word}
           where id= #{id}
         and status=1
and userid=#{userid}

    </update>


    <select id="getUrlById" resultType="string">

        select url from scenicspot where id=#{id}  and status=1 and userid=#{userid}

    </select>


    <select id="getIdByUrl" resultType="integer">

        select id from  scenicspot where url=#{url} and status=1 and userid=#{userid}

    </select>


    <select id="getMaxId" resultType="integer">

        select max(id) from scenicspot where status=1  and userid=#{userid}

    </select>


    <select id="getMinId" resultType="integer">

        select min(id) from scenicspot where status=1  and userid=#{userid}

    </select>

    <update id="addLonAndLatByUrl">

        update scenicspot set lonandlat=#{LonAndLat} where url=#{url} and userid=#{userid}

    </update>

    <select id="getMaxIdByAll" resultType="integer">

        select max(id) from scenicspot where status=1 and userid=#{userid}

    </select>


    <select id="getScenicspotByMaxId" resultMap="result">

      select *  from scenicspot where status=1 and

        id=(select max(id)  from smartplacename.scenicspot where status=1 and userid=#{userid})

        and userid=#{userid}


    </select>


    <select id="getNameAndUrl" resultMap="result">

        select name,url from smartplacename.scenicspot where status=1 and userid=#{userid}

    </select>


</mapper>